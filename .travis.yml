language: python
python: 3.9
env:
  global:
  - LOCAL_REPO: img2vec-pytorch
  - REMOTE_REPO: semitechnologies/img2vec-pytorch
  - secure: I1oX17yCNdhyvI9Nu8lgZpQ1tUuA8YLeWH2V1LA+OMNnS46ZDb7XjGWC6mIqa5LM2beizxB75tu+8/gtk57JdSJtBgnFyeKP79f7FnY97NmY00ND3P21hYIyHOBpNfUYEEfTsdrG7hKBg+NB4q//lH6xow2sBpRI52OsZIgbeN9B3lRImPCkxAehG4MtHYPUsKYci40ZWP0I2SiEb3knLR6S8i7tz8t5rc+jOjuzEM1/okLDDZgGDGlW3g/r33XHGVR30YNu3juQ5yYOt5dFG49HTNx8hSQfm6GNw5C1gqkVRXxwJWivse4Vfyb3XU1SWK70yunRx3Ojt3m6xhje0JOM33ws5pkeSpY7Imq6sZVKqq2c3oYDbawgz6A9jL2nO9E8qS4Rxqy33rpdGVoST3BgYiGVGl8/IAg7gDvkAOwXien2NHohXn9oPLKkKvPYBRt4d9uzwaQWhjwtG29HmkfohtV0Rm32vY/JkU/A04Z62n3E+eJQGG6yZnChBno9bqv9xLOOftuDbRSOsTdWeanRFtI4JcS3/eW1KfucB1RyVrVkAVKysQYMxhlc8PAGkQ9uTeL5/hjt28wJZ/dvjXEN3Cbzo5wq4Haqp49+CkrxwlnOjgcyxNdoPJtonF7QQO6gr2F2dZlRz95RvLEHwIVXxLL7qfoiCP117kUA49s=
  - secure: dpEkxFRKd9v4o7+U3nimL1O3l3ojSCYo36yeP3OvLBerQsZCoo3IYYxUG1uENe/3lilmEZCYQbKZvgCQqDk9/SoBvlAgW20mGlLbIQKnvNoZCKKzcryrEUHF8wuspiAsM4VHCqog/tvYPsXE2oFopgkUhj7A48eVr7lLv9PLp5wyxvsCrqtVAV1hEo5wXL75NlRhQICUfoZpiOTZz91mbpaf4nokUvjduY4x9PKZciRnM9z1bEI9EodUCo2FgbeMhYdNum35IG6AQkRC5ieqqoekTykX+BjMSMPTXMwA6EdWvvtrFRBpBg9X7VC8gNEDQk619PRlCC8Ic3RFUhIeY/L4Kxc2AVJMQeYfWAB5czK+OCH28B3oaYf/CfRxw7yv3lfaFZvj99a7TuoAR8Gj65R8BaSRO+RcgKtTLustenzM9qws7uXuF8WnSxRttAj7GWZJRKCSxHQStfqid39K54mfd2JnGpSLDKqUryN7amKHoREQw4fE7eaA6KOHlUrI7BbVUO1k1ktv/IiazHY/cLypXeWuS8LnFaUjoUiMsy8NxSk7QP/p2MLGKEcy7lSjMglBVyOAoDT8WuuJaLTGUCA0ZmDSxEnRX7CeOQGhURuf+9emU/Y339T7w7ktB58guk0aWVFE7mg4NwkiLxVgpUrKlJIcqGQsaKjDAmtbVQs=
install: echo skipping default travis install script
jobs:
  include:
  - env:
      MODEL_NAME: resnet50
    stage: buildanddeploy

script:

- cicd/build.sh || travis_terminate 1

- cicd/test.sh || travis_terminate 1

- |-
  # Push docker image
  GIT_BRANCH=$TRAVIS_BRANCH \
  GIT_TAG=$TRAVIS_TAG \
  GIT_PULL_REQUEST=$TRAVIS_PULL_REQUEST \
  travis_wait 90 cicd/docker_push.sh || travis_terminate 1

before_install: 
  # install a newer docker version which supports buildx
  - sudo rm -rf /var/lib/apt/lists/*
  - curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
  - sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) edge"
  - sudo apt-get update
  - sudo apt-get -y -o Dpkg::Options::="--force-confnew" install docker-ce
  - mkdir -vp ~/.docker/cli-plugins/
  - curl --silent -L "https://github.com/docker/buildx/releases/download/v0.3.0/buildx-v0.3.0.linux-amd64" > ~/.docker/cli-plugins/docker-buildx
  - chmod a+x ~/.docker/cli-plugins/docker-buildx

before_script:
  # login to docker at the very beginning, so we don't run into rate-limiting
  - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin


# currently the latest available - so we can install the latest docker
dist: bionic
